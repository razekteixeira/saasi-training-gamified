<!DOCTYPE html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SAASI Escape Room - Portal de Forma√ß√£o</title>
    <link rel="stylesheet" href="css/main.css" />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .container {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        max-width: 800px;
        width: 90%;
        text-align: center;
      }

      .header {
        margin-bottom: 40px;
      }

      .logo {
        font-size: 3rem;
        margin-bottom: 10px;
      }

      h1 {
        color: #2c3e50;
        font-size: 2.5rem;
        margin-bottom: 10px;
        font-weight: 700;
      }

      .subtitle {
        color: #7f8c8d;
        font-size: 1.2rem;
        margin-bottom: 30px;
      }

      .description {
        background: #f8f9fa;
        padding: 25px;
        border-radius: 15px;
        margin-bottom: 40px;
        text-align: left;
      }

      .description h3 {
        color: #2c3e50;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .phases {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
      }

      .phase-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .phase-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
      }

      .phase-card.locked {
        opacity: 0.6;
        pointer-events: none;
      }

      .phase-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(90deg, #667eea, #764ba2);
      }

      .phase-number {
        font-size: 2rem;
        font-weight: bold;
        color: #667eea;
        margin-bottom: 10px;
      }

      .phase-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 10px;
      }

      .phase-description {
        color: #7f8c8d;
        margin-bottom: 20px;
        line-height: 1.5;
      }

      .phase-stats {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
        font-size: 0.9rem;
      }

      .stat {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
      }

      .stat-value {
        font-weight: bold;
        color: #2c3e50;
      }

      .stat-label {
        color: #7f8c8d;
      }

      .btn {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        border: none;
        padding: 12px 30px;
        border-radius: 25px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-block;
        width: 100%;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
      }

      .btn:disabled {
        background: #bdc3c7;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .achievements {
        background: #fff;
        border-radius: 15px;
        padding: 25px;
        margin-top: 30px;
      }

      .achievements h3 {
        color: #2c3e50;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .badge {
        display: inline-block;
        background: #f1c40f;
        color: #2c3e50;
        padding: 8px 15px;
        border-radius: 20px;
        margin: 5px;
        font-size: 0.9rem;
        font-weight: 600;
      }

      .progress-overview {
        background: #ecf0f1;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
      }

      .progress-bar {
        background: #bdc3c7;
        height: 8px;
        border-radius: 4px;
        margin: 10px 0;
        overflow: hidden;
      }

      .progress-fill {
        background: linear-gradient(90deg, #667eea, #764ba2);
        height: 100%;
        transition: width 0.3s ease;
      }

      .footer {
        margin-top: 40px;
        color: #7f8c8d;
        font-size: 0.9rem;
      }

      @media (max-width: 768px) {
        .container {
          padding: 20px;
          margin: 20px;
        }

        h1 {
          font-size: 2rem;
        }

        .phases {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="logo">üéØ</div>
        <h1>SAASI Escape Room</h1>
        <div class="subtitle">
          Sistema de Forma√ß√£o Interativa para T√©cnicos SAASI
        </div>
      </div>

      <div class="description">
        <h3>üéÆ Sobre a Forma√ß√£o</h3>
        <p>
          O SAASI Escape Room √© uma experi√™ncia de forma√ß√£o imersiva que simula
          situa√ß√µes reais do atendimento e acompanhamento de desempregados de
          longa dura√ß√£o. Atrav√©s de puzzles e desafios interativos, desenvolver√°
          compet√™ncias essenciais para o exerc√≠cio profissional.
        </p>
        <div
          class="case-summary"
          style="
            background: rgba(227, 242, 253, 0.8);
            backdrop-filter: blur(5px);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 2px solid rgba(33, 150, 243, 0.3);
          "
        >
          <h3>üë§ Caso de Estudo: Felisbina Santos</h3>
          <p>
            <strong>Perfil:</strong> 56 anos, 9¬∫ ano escolaridade, vive sozinha
            numa pens√£o
          </p>
          <p>
            <strong>Situa√ß√£o:</strong> Benefici√°ria RSI (242,23‚Ç¨) + PSI
            (324,55‚Ç¨), experi√™ncia 6 meses limpeza
          </p>
          <p>
            <strong>Desafios:</strong> Depend√™ncia emocional do pai, perda
            suporte familiar, isolamento social
          </p>
        </div>
      </div>

      <div class="progress-overview">
        <h4>Progresso Geral</h4>
        <div class="progress-bar">
          <div
            class="progress-fill"
            id="overall-progress"
            style="width: 0%"
          ></div>
        </div>
        <div
          style="
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
          "
        >
          <span id="progress-text">0% conclu√≠do</span>
          <span id="total-score">Pontua√ß√£o: 0/300</span>
        </div>
      </div>

      <!-- SELETOR DE MODO DE JOGO -->
      <div
        class="game-mode-selector"
        style="
          background: #f8f9fa;
          padding: 20px;
          border-radius: 15px;
          margin-bottom: 30px;
          border-left: 4px solid #667eea;
        "
      >
        <h3 style="margin-top: 0; color: #667eea">üéÆ Modo de Jogo</h3>
        <p style="margin-bottom: 15px; color: #6c757d">
          Escolha como quer experienciar o SAASI:
        </p>

        <div style="display: flex; gap: 20px; flex-wrap: wrap">
          <label
            style="
              display: flex;
              align-items: center;
              cursor: pointer;
              padding: 15px;
              background: white;
              border-radius: 10px;
              border: 2px solid #e9ecef;
              transition: all 0.3s ease;
              flex: 1;
              min-width: 250px;
            "
            onclick="selectGameMode('normal')"
          >
            <input
              type="radio"
              name="gameMode"
              value="normal"
              checked
              style="margin-right: 12px; transform: scale(1.2)"
            />
            <div>
              <div style="font-weight: 600; color: #495057">
                üìã Modo Forma√ß√£o
              </div>
              <div style="font-size: 0.9rem; color: #6c757d">
                Experi√™ncia original focada na aprendizagem
              </div>
            </div>
          </label>

          <label
            style="
              display: flex;
              align-items: center;
              cursor: pointer;
              padding: 15px;
              background: white;
              border-radius: 10px;
              border: 2px solid #e9ecef;
              transition: all 0.3s ease;
              flex: 1;
              min-width: 250px;
            "
            onclick="selectGameMode('escape')"
          >
            <input
              type="radio"
              name="gameMode"
              value="escape"
              style="margin-right: 12px; transform: scale(1.2)"
            />
            <div>
              <div style="font-weight: 600; color: #495057">
                üéÆ Modo Escape Room
              </div>
              <div style="font-size: 0.9rem; color: #6c757d">
                Experi√™ncia imersiva com timer, pistas e c√≥digos secretos
              </div>
            </div>
          </label>
        </div>

        <div
          id="mode-description"
          style="
            margin-top: 15px;
            padding: 15px;
            background: #e3f2fd;
            border-radius: 8px;
            border-left: 3px solid #2196f3;
          "
        >
          <strong>Modo Forma√ß√£o:</strong> Foco na aprendizagem das compet√™ncias
          SAASI com interface limpa e intuitiva.
        </div>
      </div>

      <div class="phases">
        <!-- Fase 1 -->
        <div class="phase-card" id="phase-1">
          <div class="phase-number">01</div>
          <div class="phase-title">Acolhimento e Avalia√ß√£o Inicial</div>
          <div class="phase-description">
            Realize o primeiro acolhimento da Felisbina Santos e determine a sua
            disponibilidade e capacidade para trabalhar.
          </div>
          <div class="phase-stats">
            <div class="stat">
              <div class="stat-value" id="phase1-score">--</div>
              <div class="stat-label">Pontua√ß√£o</div>
            </div>
            <div class="stat">
              <div class="stat-value">15-20min</div>
              <div class="stat-label">Dura√ß√£o</div>
            </div>
            <div class="stat">
              <div class="stat-value" id="phase1-status">üîí</div>
              <div class="stat-label">Estado</div>
            </div>
          </div>
          <a href="fase1.html" class="btn" id="phase1-btn">Come√ßar Fase 1</a>
        </div>

        <!-- Fase 2 -->
        <div class="phase-card locked" id="phase-2">
          <div class="phase-number">02</div>
          <div class="phase-title">Identifica√ß√£o de Necessidades</div>
          <div class="phase-description">
            Analise os problemas identificados e crie um plano de interven√ß√£o
            personalizado para a Felisbina.
          </div>
          <div class="phase-stats">
            <div class="stat">
              <div class="stat-value" id="phase2-score">--</div>
              <div class="stat-label">Pontua√ß√£o</div>
            </div>
            <div class="stat">
              <div class="stat-value">15-20min</div>
              <div class="stat-label">Dura√ß√£o</div>
            </div>
            <div class="stat">
              <div class="stat-value" id="phase2-status">üîí</div>
              <div class="stat-label">Estado</div>
            </div>
          </div>
          <a href="fase2.html" class="btn" id="phase2-btn" disabled
            >Requer Fase 1</a
          >
        </div>

        <!-- Fase 3 - Plano de Interven√ß√£o -->
        <div class="phase-card locked" id="phase-3">
          <div class="phase-number">03</div>
          <div class="phase-title">Plano de Interven√ß√£o</div>
          <div class="phase-description">
            Criar estrat√©gia de acompanhamento personalizada para a Felisbina.
            Selecionar programas, articular entidades e definir cronograma.
          </div>
          <div class="phase-stats">
            <div class="stat">
              <div class="stat-value" id="phase3-score">--</div>
              <div class="stat-label">Pontua√ß√£o</div>
            </div>
            <div class="stat">
              <div class="stat-value">15-20min</div>
              <div class="stat-label">Dura√ß√£o</div>
            </div>
            <div class="stat">
              <div class="stat-value" id="phase3-status">üîí</div>
              <div class="stat-label">Estado</div>
            </div>
          </div>
          <button
            class="btn"
            id="phase3-btn"
            disabled
          >
            Requer Fase 2 (60+ pontos)
          </button>
        </div>

        <!-- Fase 4 - Implementa√ß√£o e Acompanhamento -->
        <div class="phase-card locked" id="phase-4">
          <div class="phase-number">04</div>
          <div class="phase-title">Implementa√ß√£o e Acompanhamento</div>
          <div class="phase-description">
            Executar o plano de interven√ß√£o, gerir imprevistos e ajustar
            estrat√©gias conforme necess√°rio para promover a autonomia.
          </div>
          <div class="phase-stats">
            <div class="stat">
              <div class="stat-value" id="phase4-score">--</div>
              <div class="stat-label">Pontua√ß√£o</div>
            </div>
            <div class="stat">
              <div class="stat-value">25-30min</div>
              <div class="stat-label">Dura√ß√£o</div>
            </div>
            <div class="stat">
              <div class="stat-value" id="phase4-status">üîí</div>
              <div class="stat-label">Estado</div>
            </div>
          </div>
          <button
            class="btn"
            id="phase4-btn"
            disabled
          >
            Requer Fase 3 (65+ pontos)
          </button>
        </div>
      </div>

      <div class="achievements" id="achievements">
        <h3>üèÜ Conquistas Desbloqueadas</h3>
        <div id="badges-container">
          <div style="color: #7f8c8d; font-style: italic">
            Complete as fases para desbloquear conquistas
          </div>
        </div>
      </div>

      <!-- Utility Buttons Section -->
      <div
        class="utility-buttons"
        style="
          background: #f8f9fa;
          padding: 25px;
          border-radius: 15px;
          margin: 30px 0;
          text-align: center;
          border-left: 4px solid #28a745;
        "
      >
        <h3 style="margin-top: 0; color: #28a745; margin-bottom: 20px">
          üõ†Ô∏è Ferramentas e Recursos
        </h3>
        <div
          style="
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
          "
        >
          <a
            href="timeline.html"
            style="
              background: linear-gradient(135deg, #ff9800, #f57c00);
              color: white;
              text-decoration: none;
              padding: 12px 25px;
              border-radius: 25px;
              font-weight: 600;
              display: inline-block;
              transition: all 0.3s ease;
              box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
              min-width: 200px;
            "
            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(255, 152, 0, 0.4)'"
            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(255, 152, 0, 0.3)'"
          >
            üïê Ver Timeline Completa
          </a>
          <!-- <a
            href="navigation-test.html"
            style="
              background: linear-gradient(135deg, #2196f3, #1976d2);
              color: white;
              text-decoration: none;
              padding: 12px 25px;
              border-radius: 25px;
              font-weight: 600;
              display: inline-block;
              transition: all 0.3s ease;
              box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
              min-width: 200px;
            "
            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(33, 150, 243, 0.4)'"
            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(33, 150, 243, 0.3)'"
          >
            üß≠ Teste de Navega√ß√£o URL
          </a>
          <a
            href="data-generation-demo.html"
            style="
              background: linear-gradient(135deg, #28a745, #20c997);
              color: white;
              text-decoration: none;
              padding: 12px 25px;
              border-radius: 25px;
              font-weight: 600;
              display: inline-block;
              transition: all 0.3s ease;
              box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
              min-width: 200px;
            "
            onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(40, 167, 69, 0.4)'"
            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(40, 167, 69, 0.3)'"
          >
            üîÑ Demo Gera√ß√£o de Dados
          </a> -->
        </div>

        <!-- Dicas and Navega√ß√£o buttons -->
        <!-- <div
          style="
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #dee2e6;
          "
        >
          <h4 style="color: #6c757d; margin-bottom: 15px">
            üí° Ajuda e Navega√ß√£o
          </h4>
          <div
            style="
              display: flex;
              gap: 15px;
              justify-content: center;
              flex-wrap: wrap;
            "
          >
            <button
              id="hints-button"
              onclick="showHintsInfo()"
              style="
                background: rgba(23, 162, 184, 0.9);
                color: white;
                border: none;
                padding: 12px 20px;
                border-radius: 25px;
                cursor: pointer;
                font-weight: 600;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
                min-width: 150px;
              "
              onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(23, 162, 184, 0.4)'"
              onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0, 0, 0, 0.1)'"
            >
              üí° Dicas
            </button>
            <button
              id="navigation-button"
              onclick="showNavigationInfo()"
              style="
                background: rgba(108, 117, 125, 0.9);
                color: white;
                border: none;
                padding: 12px 20px;
                border-radius: 25px;
                cursor: pointer;
                font-weight: 600;
                transition: all 0.3s ease;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
                min-width: 150px;
              "
              onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(108, 117, 125, 0.4)'"
              onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0, 0, 0, 0.1)'"
            >
              üß≠ Navega√ß√£o
            </button>
          </div>
        </div>
      </div> -->

      <div class="footer">
        <p>SAASI - Servi√ßo de Atendimento e Acompanhamento Social Integrado</p>
        <p>Sistema de Forma√ß√£o Desenvolvido para T√©cnicos Especializados</p>
      </div>
    </div>

    <!-- Reset Game Section -->
    <div
    class="reset-section"
    id="reset-section"
    style="
      text-align: center;
      margin: 30px 0;
      padding: 20px;
      background: rgba(255, 193, 7, 0.1);
      border-radius: 8px;
      border-left: 4px solid #ffc107;
    "
  >
    <h3 style="color: #e67e22; margin-bottom: 10px">
      üîÑ Gest√£o de Progresso
    </h3>
    <p style="color: #666; margin-bottom: 15px; font-size: 14px">
      Para testar ou recome√ßar o jogo desde o in√≠cio
    </p>
    <button
      class="reset-btn"
      onclick="handleResetClick()"
      style="
        background: #e74c3c;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s;
      "
      onmouseover="this.style.background='#c0392b'"
      onmouseout="this.style.background='#e74c3c'"
    >
      üóëÔ∏è Reiniciar Jogo Completo
    </button>
    <div
      id="reset-status"
      style="margin-top: 10px; font-size: 12px; color: #666"
    ></div>
  </div>

    <script>
      // Estado global da aplica√ß√£o
      let appState = {
        phases: {
          phase1: { unlocked: true, completed: false, score: 0 },
          phase2: { unlocked: false, completed: false, score: 0 },
          phase3: { unlocked: false, completed: false, score: 0 },
          phase4: { unlocked: false, completed: false, score: 0 },
        },
        achievements: [],
        totalScore: 0,
      };

      // Carregar estado salvo
      function loadAppState() {
        // Carregar dados da Fase 1
        const phase1Data = localStorage.getItem("saasi_phase1_results");
        if (phase1Data) {
          const data = JSON.parse(phase1Data);
          appState.phases.phase1.completed = true;
          appState.phases.phase1.score = data.score || 0;
          appState.phases.phase2.unlocked = data.score >= 70;
        }

        // Carregar dados da Fase 2
        const phase2Data = localStorage.getItem("saasi_phase2_results");
        if (phase2Data) {
          const data = JSON.parse(phase2Data);
          appState.phases.phase2.completed = true;
          appState.phases.phase2.score = data.score || 0;
          appState.phases.phase3.unlocked = data.score >= 60;
        }

        // Carregar dados da Fase 3
        const phase3Data = localStorage.getItem("saasi_phase3_results");
        if (phase3Data) {
          const data = JSON.parse(phase3Data);
          appState.phases.phase3.completed = true;
          appState.phases.phase3.score = data.score || 0;
          appState.phases.phase4.unlocked = data.score >= 65;
        }

        // Carregar dados da Fase 4
        const phase4Data = localStorage.getItem("saasi_phase4_results");
        if (phase4Data) {
          const data = JSON.parse(phase4Data);
          appState.phases.phase4.completed = true;
          appState.phases.phase4.score = data.score || 0;
        }

        // Calcular pontua√ß√£o total (limitada ao m√°ximo de 400)
        appState.totalScore = Math.min(
          appState.phases.phase1.score +
            appState.phases.phase2.score +
            appState.phases.phase3.score +
            appState.phases.phase4.score,
          400
        );
      }

      // Atualizar interface
      function updateUI() {
        // Fase 1
        const phase1Btn = document.getElementById("phase1-btn");
        const phase1Score = document.getElementById("phase1-score");
        const phase1Status = document.getElementById("phase1-status");

        if (appState.phases.phase1.completed) {
          phase1Score.textContent = `${appState.phases.phase1.score}/100`;
          phase1Status.textContent = "‚úÖ";
          if (selectedGameMode === "escape") {
            phase1Btn.innerHTML = "üéÆ Repetir Miss√£o";
          } else {
            phase1Btn.textContent = "Repetir Fase 1";
          }
        } else {
          phase1Score.textContent = "--";
          phase1Status.textContent = "üéØ";
          if (selectedGameMode === "escape") {
            phase1Btn.innerHTML = "üéÆ Iniciar Miss√£o";
          } else {
            phase1Btn.textContent = "Come√ßar Fase 1";
          }
        }

        // Fase 2
        const phase2Card = document.getElementById("phase-2");
        const phase2Btn = document.getElementById("phase2-btn");
        const phase2Score = document.getElementById("phase2-score");
        const phase2Status = document.getElementById("phase2-status");

        if (appState.phases.phase2.unlocked) {
          phase2Card.classList.remove("locked");
          phase2Btn.disabled = false;

          if (appState.phases.phase2.completed) {
            phase2Score.textContent = `${appState.phases.phase2.score}/100`;
            phase2Status.textContent = "‚úÖ";
            if (selectedGameMode === "escape") {
              phase2Btn.innerHTML = "üéÆ Repetir Miss√£o 2";
            } else {
              phase2Btn.textContent = "Repetir Fase 2";
            }
          } else {
            phase2Score.textContent = "--";
            phase2Status.textContent = "üéØ";
            if (selectedGameMode === "escape") {
              phase2Btn.innerHTML = "üéÆ Miss√£o 2";
            } else {
              phase2Btn.textContent = "Come√ßar Fase 2";
            }
          }
        } else {
          phase2Card.classList.add("locked");
          phase2Btn.disabled = true;
          phase2Score.textContent = "--";
          phase2Status.textContent = "üîí";
          phase2Btn.textContent = "Requer Fase 1 (70+ pontos)";
        }

        // Fase 3
        const phase3Card = document.getElementById("phase-3");
        const phase3Btn = document.getElementById("phase3-btn");
        const phase3Score = document.getElementById("phase3-score");
        const phase3Status = document.getElementById("phase3-status");

        if (appState.phases.phase3.unlocked) {
          phase3Card.classList.remove("locked");
          phase3Btn.disabled = false;

          if (appState.phases.phase3.completed) {
            phase3Score.textContent = `${appState.phases.phase3.score}/100`;
            phase3Status.textContent = "‚úÖ";
            if (selectedGameMode === "escape") {
              phase3Btn.innerHTML = "üéÆ Repetir Miss√£o 3";
            } else {
              phase3Btn.textContent = "Repetir Fase 3";
            }
          } else {
            phase3Score.textContent = "--";
            phase3Status.textContent = "üéØ";
            if (selectedGameMode === "escape") {
              phase3Btn.innerHTML = "üéÆ Miss√£o 3";
            } else {
              phase3Btn.textContent = "Come√ßar Fase 3";
            }
          }
        } else {
          phase3Card.classList.add("locked");
          phase3Btn.disabled = true;
          phase3Score.textContent = "--";
          phase3Status.textContent = "üîí";
          phase3Btn.textContent = "Requer Fase 2 (60+ pontos)";
        }

        // Fase 4
        const phase4Card = document.getElementById("phase-4");
        const phase4Btn = document.getElementById("phase4-btn");
        const phase4Score = document.getElementById("phase4-score");
        const phase4Status = document.getElementById("phase4-status");

        if (appState.phases.phase4.unlocked) {
          phase4Card.classList.remove("locked");
          phase4Btn.disabled = false;

          if (appState.phases.phase4.completed) {
            phase4Score.textContent = `${appState.phases.phase4.score}/100`;
            phase4Status.textContent = "‚úÖ";
            if (selectedGameMode === "escape") {
              phase4Btn.innerHTML = "üéÆ Repetir Miss√£o 4";
            } else {
              phase4Btn.textContent = "Repetir Fase 4";
            }
          } else {
            phase4Score.textContent = "--";
            phase4Status.textContent = "üéØ";
            if (selectedGameMode === "escape") {
              phase4Btn.innerHTML = "üéÆ Miss√£o 4";
            } else {
              phase4Btn.textContent = "Come√ßar Fase 4";
            }
          }
        } else {
          phase4Card.classList.add("locked");
          phase4Btn.disabled = true;
          phase4Score.textContent = "--";
          phase4Status.textContent = "üîí";
          phase4Btn.textContent = "Requer Fase 3 (65+ pontos)";
        }

        // Progresso geral
        let completedPhases = 0;
        if (appState.phases.phase1.completed) completedPhases++;
        if (appState.phases.phase2.completed) completedPhases++;
        if (appState.phases.phase3.completed) completedPhases++;
        if (appState.phases.phase4.completed) completedPhases++;

        const progressPercentage = (completedPhases / 4) * 100;
        document.getElementById(
          "overall-progress"
        ).style.width = `${progressPercentage}%`;
        document.getElementById("progress-text").textContent = `${Math.round(
          progressPercentage
        )}% conclu√≠do`;
        document.getElementById(
          "total-score"
        ).textContent = `Pontua√ß√£o: ${appState.totalScore}/400`;

        // Conquistas
        updateAchievements();
      }

      // Atualizar conquistas
      function updateAchievements() {
        const badgesContainer = document.getElementById("badges-container");
        const achievements = [];

        // Conquistas baseadas na pontua√ß√£o
        if (appState.phases.phase1.score >= 95) {
          achievements.push("üèÜ Mestre da Fase 1");
        }
        if (appState.phases.phase2.score >= 95) {
          achievements.push("üèÜ Mestre da Fase 2");
        }
        if (appState.phases.phase3.score >= 95) {
          achievements.push("üèÜ Mestre da Fase 3");
        }
        if (appState.phases.phase4.score >= 95) {
          achievements.push("üèÜ Mestre da Fase 4");
        }
        if (appState.phases.phase1.score >= 85) {
          achievements.push("‚≠ê Especialista Fase 1");
        }
        if (appState.phases.phase2.score >= 85) {
          achievements.push("‚≠ê Especialista Fase 2");
        }
        if (appState.phases.phase3.score >= 85) {
          achievements.push("‚≠ê Especialista Fase 3");
        }
        if (appState.phases.phase4.score >= 85) {
          achievements.push("‚≠ê Especialista Fase 4");
        }
        if (
          appState.phases.phase1.completed &&
          appState.phases.phase2.completed &&
          appState.phases.phase3.completed
        ) {
          achievements.push("üéØ T√©cnico Completo");
        }
        if (
          appState.phases.phase1.completed &&
          appState.phases.phase2.completed &&
          appState.phases.phase3.completed &&
          appState.phases.phase4.completed
        ) {
          achievements.push("üëë Master SAASI - Escape Room Completo");
        }
        if (appState.totalScore >= 240) {
          achievements.push("üíé T√©cnico Experiente");
        }
        if (appState.totalScore >= 340) {
          achievements.push("üåü Mestre SAASI Absoluto");
        }

        if (achievements.length > 0) {
          badgesContainer.innerHTML = achievements
            .map((achievement) => `<span class="badge">${achievement}</span>`)
            .join("");
        } else {
          badgesContainer.innerHTML =
            '<div style="color: #7f8c8d; font-style: italic;">Complete as fases para desbloquear conquistas</div>';
        }
      }

      // SISTEMA DE TOGGLE DE MODO DE JOGO
      let selectedGameMode = "normal";

      function selectGameMode(mode) {
        selectedGameMode = mode;

        // Atualizar sele√ß√£o visual
        document.querySelectorAll('input[name="gameMode"]').forEach((input) => {
          const label = input.closest("label");
          if (input.value === mode) {
            input.checked = true;
            label.style.borderColor = "#667eea";
            label.style.background = "#f8f9ff";
          } else {
            input.checked = false;
            label.style.borderColor = "#e9ecef";
            label.style.background = "white";
          }
        });

        // Atualizar descri√ß√£o
        updateModeDescription(mode);

        // Atualizar links das fases
        updatePhaseLinks();

        // Salvar prefer√™ncia
        localStorage.setItem("saasi_game_mode", mode);
      }

      function updateModeDescription(mode) {
        const description = document.getElementById("mode-description");

        if (mode === "escape") {
          description.innerHTML = `
            <strong>Modo Escape Room:</strong> Experi√™ncia imersiva com timer de 45 minutos, elementos ocultos para descobrir, 
            c√≥digos secretos, avatar reativo da Felisbina e pontua√ß√£o aumentada (at√© 150 pontos). 
            <span style="color: #d32f2f;">‚ö†Ô∏è Mais desafiante!</span>
          `;
          description.style.background = "#fff3e0";
          description.style.borderLeftColor = "#ff9800";
        } else {
          description.innerHTML = `
            <strong>Modo Forma√ß√£o:</strong> Foco na aprendizagem das compet√™ncias SAASI com interface limpa e intuitiva.
          `;
          description.style.background = "#e3f2fd";
          description.style.borderLeftColor = "#2196f3";
        }
      }

      function updatePhaseLinks() {
        console.log("updatePhaseLinksASDASDASDASDASD");
        // Update all phase buttons based on selected game mode
        const phases = [
          {
            id: "phase1-btn",
            normal: "fase1.html",
            escape: "fase1-escape.html",
            text: "Fase 1",
          },
          {
            id: "phase2-btn",
            normal: "fase2.html",
            escape: "fase2-escape.html",
            text: "Fase 2",
          },
          {
            id: "phase3-btn",
            normal: "fase3.html",
            escape: "fase3-escape.html",
            text: "Fase 3",
          },
          {
            id: "phase4-btn",
            normal: "fase4.html",
            escape: "fase4-escape.html",
            text: "Fase 4",
          },
        ];

        phases.forEach((phase) => {
          const btn = document.getElementById(phase.id);
          if (btn) {
            if (selectedGameMode === "escape") {
              // Handle both anchor tags (href) and button elements (onclick)
              if (btn.tagName.toLowerCase() === 'a') {
                btn.href = phase.escape;
              } else if (btn.tagName.toLowerCase() === 'button') {
                btn.onclick = () => window.location.href = phase.escape;
              }
              
              if (phase.id === "phase1-btn") {
                btn.innerHTML = "üéÆ Iniciar Miss√£o";
              } else {
                btn.innerHTML = `üéÆ Miss√£o ${phase.text.split(" ")[1]}`;
              }
              btn.style.background =
                "linear-gradient(135deg, #ff9800 0%, #f57c00 100%)";
            } else {
              // Handle both anchor tags (href) and button elements (onclick)
              if (btn.tagName.toLowerCase() === 'a') {
                btn.href = phase.normal;
              } else if (btn.tagName.toLowerCase() === 'button') {
                btn.onclick = () => window.location.href = phase.normal;
              }
              
              if (phase.id === "phase1-btn") {
                btn.innerHTML = "üìã Come√ßar Fase 1";
              } else {
                btn.innerHTML = `üìã Come√ßar ${phase.text}`;
              }
              btn.style.background =
                "linear-gradient(135deg, #667eea 0%, #764ba2 100%)";
            }
          }
        });
      }

      function loadGameModePreference() {
        const savedMode = localStorage.getItem("saasi_game_mode");
        if (savedMode && (savedMode === "normal" || savedMode === "escape")) {
          selectGameMode(savedMode);
        }
      }

      // Inicializa√ß√£o
      document.addEventListener("DOMContentLoaded", () => {
        loadAppState();
        updateUI();
        loadGameModePreference();
      });

      // Recarregar quando voltar √† p√°gina
      window.addEventListener("focus", () => {
        loadAppState();
        updateUI();
      });
    </script>

    <!-- Enhanced Integration -->
    <script src="js/shared.js"></script>
    <script src="js/multi-phase-coordinator.js"></script>
    <script src="js/modal-system.js"></script>
    <script>
      // Legacy function - no longer needed
      // Dependencies are checked directly in reset functions

      // Enhanced progress tracking with MultiPhaseCoordinator
      function loadEnhancedAppState() {
        try {
          const gameState = MultiPhaseCoordinator.getGameState();

          // Update individual phase scores and unlock status
          for (let phase = 1; phase <= 4; phase++) {
            const phaseElement = document.getElementById(`phase${phase}-score`);
            const phaseBtnElement = document.getElementById(
              `phase${phase}-btn`
            );

            if (phaseElement && gameState.phases[`phase${phase}`]) {
              const phaseData = gameState.phases[`phase${phase}`];
              phaseElement.textContent = `${phaseData.score}/100`;
              phaseElement.style.color =
                phaseData.score >= 85
                  ? "#4caf50"
                  : phaseData.score >= 60
                  ? "#ff9800"
                  : "#757575";
            }

            // Enhanced unlock status
            if (phaseBtnElement && gameState.unlocked[phase]) {
              const unlockData = gameState.unlocked[phase];
              if (!unlockData.unlocked) {
                phaseBtnElement.style.opacity = "0.5";
                phaseBtnElement.style.cursor = "not-allowed";
                phaseBtnElement.title = unlockData.reason;
                phaseBtnElement.onclick = (e) => {
                  e.preventDefault();
                  ModalSystem.alert(
                    `üîí ${unlockData.reason}<br><br>
                    <strong>Pontua√ß√£o necess√°ria:</strong> ${
                      unlockData.requiredScore
                    }<br>
                    <strong>Pontua√ß√£o atual:</strong> ${
                      unlockData.currentScore || 0
                    }`,
                    "warning"
                  );
                };
              } else {
                phaseBtnElement.style.opacity = "1";
                phaseBtnElement.style.cursor = "pointer";
                phaseBtnElement.title = "";
                phaseBtnElement.onclick = null;
              }
            }
          }

          // Update overall progress
          const progressElement = document.getElementById("overall-progress");
          if (progressElement) {
            progressElement.innerHTML = `
              <div style="text-align: center; margin: 20px 0;">
                <h3>üìä Progresso Geral</h3>
                <div style="font-size: 2rem; margin: 10px 0; color: ${gameState.progress.overallLevel.color};">
                  ${gameState.progress.totalScore}/400 pontos (${gameState.progress.percentage}%)
                </div>
                <div style="background: #e0e0e0; height: 20px; border-radius: 10px; overflow: hidden; margin: 10px 0;">
                  <div style="background: linear-gradient(90deg, #4caf50, #2196f3); height: 100%; width: ${gameState.progress.percentage}%; transition: width 0.3s ease;"></div>
                </div>
                <div style="margin-top: 10px;">
                  <strong>N√≠vel:</strong> ${gameState.progress.overallLevel.title}<br>
                  <strong>Fases Completas:</strong> ${gameState.progress.completedPhases}/4
                </div>
              </div>
            `;
          }

          // Update Felisbina journey narrative
          const narrativeElement = document.getElementById("felisbina-journey");
          if (
            narrativeElement &&
            gameState.felisbinaJourney.progressNarrative
          ) {
            narrativeElement.innerHTML = `
              <div style="background: #f5f5f5; padding: 20px; border-radius: 10px; margin: 20px 0; text-align: left;">
                <h4>üéØ Jornada da Felisbina</h4>
                <p style="margin: 10px 0; line-height: 1.6;">${gameState.felisbinaJourney.progressNarrative}</p>
                <div style="margin-top: 15px;">
                  <strong>Estado Atual:</strong> ${gameState.felisbinaJourney.currentStage}
                </div>
              </div>
            `;
          }
        } catch (error) {
          console.error("Error loading enhanced app state:", error);
          // Fallback to original loadAppState logic
          originalLoadAppState();
        }
      }

      // Store original function as backup
      const originalLoadAppState = window.loadAppState || function () {};

      // Comprehensive reset function that clears everything
      function performCompleteReset() {
        try {
          console.log("Performing complete reset...");

          // Clear ALL localStorage - not just specific keys
          localStorage.clear();
          console.log("All localStorage cleared");

          // Reset global app state to initial values
          window.appState = {
            phases: {
              phase1: { unlocked: true, completed: false, score: 0 },
              phase2: { unlocked: false, completed: false, score: 0 },
              phase3: { unlocked: false, completed: false, score: 0 },
              phase4: { unlocked: false, completed: false, score: 0 },
            },
            achievements: [],
            totalScore: 0,
          };

          // Try to reset MultiPhaseCoordinator if available
          if (typeof MultiPhaseCoordinator !== "undefined") {
            try {
              MultiPhaseCoordinator.resetAllData();
              console.log("MultiPhaseCoordinator reset successful");
            } catch (error) {
              console.warn("MultiPhaseCoordinator reset failed:", error);
            }
          }

          // Try to reset SaaSIStorage if available
          if (typeof SaaSIStorage !== "undefined") {
            try {
              SaaSIStorage.clearAllData();
              console.log("SaaSIStorage reset successful");
            } catch (error) {
              console.warn("SaaSIStorage reset failed:", error);
            }
          }

          // Reset game mode to default
          window.selectedGameMode = "normal";

          console.log("Complete reset performed successfully");

          // Refresh the page to ensure clean state
          setTimeout(() => {
            window.location.reload();
          }, 500);

          return true;
        } catch (error) {
          console.error("Error in performCompleteReset:", error);
          return false;
        }
      }

      // Force UI refresh after reset
      function refreshUIAfterReset() {
        try {
          // Update all progress indicators
          document.getElementById("overall-progress").style.width = "0%";
          document.getElementById("progress-text").textContent = "0% conclu√≠do";
          document.getElementById("total-score").textContent =
            "Pontua√ß√£o: 0/400";

          // Reset all phase cards to initial state
          // Phase 1 - Always unlocked
          document.getElementById("phase1-score").textContent = "--";
          document.getElementById("phase1-status").textContent = "üéØ";
          document.getElementById("phase1-btn").textContent = "Come√ßar Fase 1";
          document.getElementById("phase-1").classList.remove("locked");
          document.getElementById("phase1-btn").disabled = false;

          // Phase 2 - Locked
          document.getElementById("phase2-score").textContent = "--";
          document.getElementById("phase2-status").textContent = "üîí";
          document.getElementById("phase2-btn").textContent =
            "Requer Fase 1 (70+ pontos)";
          document.getElementById("phase-2").classList.add("locked");
          document.getElementById("phase2-btn").disabled = true;

          // Phase 3 - Locked
          document.getElementById("phase3-score").textContent = "--";
          document.getElementById("phase3-status").textContent = "üîí";
          document.getElementById("phase3-btn").textContent =
            "Requer Fase 2 (60+ pontos)";
          document.getElementById("phase-3").classList.add("locked");
          document.getElementById("phase3-btn").disabled = true;

          // Phase 4 - Locked
          document.getElementById("phase4-score").textContent = "--";
          document.getElementById("phase4-status").textContent = "üîí";
          document.getElementById("phase4-btn").textContent =
            "Requer Fase 3 (65+ pontos)";
          document.getElementById("phase-4").classList.add("locked");
          document.getElementById("phase4-btn").disabled = true;

          // Reset achievements
          const badgesContainer = document.getElementById("badges-container");
          if (badgesContainer) {
            badgesContainer.innerHTML =
              '<div style="color: #7f8c8d; font-style: italic;">Complete as fases para desbloquear conquistas</div>';
          }

          // Reset game mode selection
          selectGameMode("normal");

          console.log("UI refreshed after reset");
        } catch (error) {
          console.error("Error refreshing UI after reset:", error);
        }
      }

      // Enhanced reset function (legacy - now uses showResetConfirmation)
      async function resetAllProgressEnhanced() {
        console.log(
          "resetAllProgressEnhanced called - redirecting to showResetConfirmation"
        );
        return await showResetConfirmation();
      }

      // Reset confirmation function for the UI button
      async function showResetConfirmation() {
        console.log("showResetConfirmation called");
        const statusDiv = document.getElementById("reset-status");

        try {
          // Check if ModalSystem is available and ready
          if (window.ModalSystem) {
            console.log("ModalSystem available, showing modal...");

            // Show confirmation dialog
            const confirmReset = await ModalSystem.confirm(
              "üîÑ <strong>REINICIAR JOGO COMPLETO</strong><br><br>" +
                "Esta a√ß√£o ir√°:<br>" +
                "‚Ä¢ Apagar todos os resultados das 4 fases<br>" +
                "‚Ä¢ Remover todas as conquistas<br>" +
                "‚Ä¢ Limpar o progresso guardado<br>" +
                "‚Ä¢ Recarregar a p√°gina automaticamente<br><br>" +
                "‚ö†Ô∏è <strong>Esta a√ß√£o n√£o pode ser desfeita!</strong><br><br>" +
                "Deseja continuar?",
              {
                title: "üîÑ Reiniciar Jogo",
                okText: "Sim, reiniciar",
                cancelText: "Cancelar",
                type: "warning",
              }
            );

            if (confirmReset) {
              statusDiv.innerHTML =
                '<span style="color: #e67e22;">‚è≥ A limpar dados e recarregar p√°gina...</span>';

              // Use the comprehensive reset function (will auto-refresh page)
              performCompleteReset();
            } else {
              statusDiv.innerHTML =
                '<span style="color: #666;">Opera√ß√£o cancelada.</span>';
              setTimeout(() => {
                statusDiv.innerHTML = "";
              }, 2000);
            }
          } else {
            // Fallback to native confirm if ModalSystem not available
            console.log("ModalSystem not available, using native confirm");
            const originalConfirm = window._originalConfirm || confirm;

            if (
              originalConfirm(
                "üîÑ REINICIAR JOGO COMPLETO\n\nEsta a√ß√£o ir√°:\n‚Ä¢ Apagar todos os resultados das 4 fases\n‚Ä¢ Remover todas as conquistas\n‚Ä¢ Limpar o progresso guardado\n‚Ä¢ Recarregar a p√°gina\n\n‚ö†Ô∏è Esta a√ß√£o n√£o pode ser desfeita!\n\nDeseja continuar?"
              )
            ) {
              statusDiv.innerHTML =
                '<span style="color: #e67e22;">‚è≥ A limpar dados e recarregar p√°gina...</span>';

              // Use the comprehensive reset function (will auto-refresh page)
              performCompleteReset();
            } else {
              statusDiv.innerHTML =
                '<span style="color: #666;">Opera√ß√£o cancelada.</span>';
              setTimeout(() => {
                statusDiv.innerHTML = "";
              }, 2000);
            }
          }
        } catch (error) {
          console.error("Reset function error:", error);

          // Last resort fallback
          const originalConfirm = window._originalConfirm || confirm;
          if (
            originalConfirm(
              "Tem a certeza de que deseja reiniciar todo o progresso? A p√°gina ser√° recarregada."
            )
          ) {
            if (statusDiv) {
              statusDiv.innerHTML =
                '<span style="color: #e67e22;">‚è≥ A limpar dados e recarregar p√°gina...</span>';
            }

            // Use the comprehensive reset function (will auto-refresh page)
            performCompleteReset();
          }
        }
      }

      // Single reset handler that works with onclick
      function handleResetClick() {
        console.log("Reset button clicked!");

        // Use a timeout to allow the browser to process the click
        setTimeout(async () => {
          try {
            console.log("Attempting to show reset confirmation...");
            await showResetConfirmation();
          } catch (error) {
            console.error("Reset click handler error:", error);
            // Fallback to simple confirmation
            const originalConfirm = window._originalConfirm || confirm;
            console.log("Using fallback confirmation");
            if (
              originalConfirm(
                "Tem a certeza de que deseja reiniciar todo o progresso? A p√°gina ser√° recarregada."
              )
            ) {
              // Use the comprehensive reset function (will auto-refresh page)
              performCompleteReset();
              console.log("Fallback reset initiated");
            }
          }
        }, 0);
      }

      // Functions for Dicas and Navega√ß√£o buttons
      function showHintsInfo() {
        if (window.ModalSystem) {
          ModalSystem.alert(
            `<h3>üí° Sistema de Dicas</h3>
            <p>As dicas est√£o dispon√≠veis durante as fases do jogo:</p>
            <ul style="text-align: left; margin: 15px 0;">
              <li>üéØ <strong>Modo Forma√ß√£o:</strong> Orienta√ß√µes contextuais para aprendizagem</li>
              <li>üéÆ <strong>Modo Escape Room:</strong> Pistas para resolver puzzles e encontrar c√≥digos</li>
              <li>üîç <strong>Dicas Espec√≠ficas:</strong> Cada fase tem dicas personalizadas</li>
              <li>‚≠ê <strong>Dicas Progressivas:</strong> Ajuda aumenta conforme a dificuldade</li>
            </ul>
            <p><strong>üí° Dica:</strong> As dicas aparecem automaticamente nas fases quando necess√°rio!</p>`,
            "info"
          );
        } else {
          alert(
            "üí° Sistema de Dicas\n\nAs dicas est√£o dispon√≠veis durante as fases do jogo para ajudar na aprendizagem e resolu√ß√£o de puzzles."
          );
        }
      }

      function showNavigationInfo() {
        if (window.ModalSystem) {
          ModalSystem.alert(
            `<h3>üß≠ Sistema de Navega√ß√£o</h3>
            <p>Navegue facilmente entre as diferentes se√ß√µes:</p>
            <ul style="text-align: left; margin: 15px 0;">
              <li>üè† <strong>P√°gina Principal:</strong> Vis√£o geral e sele√ß√£o de fases</li>
              <li>üìä <strong>Timeline:</strong> Visualiza√ß√£o completa do caso Felisbina</li>
              <li>üîß <strong>Testes:</strong> Ferramentas de desenvolvimento e teste</li>
              <li>üìà <strong>Progresso:</strong> Acompanhamento autom√°tico do seu avan√ßo</li>
            </ul>
            <p><strong>üéØ Dica:</strong> Use os bot√µes de navega√ß√£o nas fases para voltar facilmente!</p>`,
            "info"
          );
        } else {
          alert(
            "üß≠ Sistema de Navega√ß√£o\n\nUse os menus e bot√µes para navegar entre as diferentes se√ß√µes do sistema SAASI."
          );
        }
      }

      console.log(
        "Enhanced navigation with MultiPhaseCoordinator loaded successfully"
      );
    </script>
  </body>
</html>
